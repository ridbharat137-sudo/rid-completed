<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verify Certificate</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="../css/verify.css" />
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

</head>
<style>
  .buttons {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  text-decoration: none;   /* ✅ UNDERLINE REMOVED */
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
  background: linear-gradient(135deg, #16a34a, #22c55e); /* ✅ Green Gradient */
}


</style>
<body>
  <header>
    <div class="header">
      <div class="web-text">
        <p>
          Website:
          <span>RID (Reserch Innovation & Discovery) by TWKSAA Welfare Foundation
          </span>
        </p>

        <p>Helpline: <span>+91 9202707903 </span></p>
        <p>Email: <span>ridorg.in@gmail.com </span></p>
      </div>
      <div class="right-text">
        <a class="link"><object class="svg-object" data="/assets/icons/important_devices.svg"
            type="image/svg+xml"></object>Main Content</a>
        <a class="link">+A A A-</a>
        <a class="link"><object class="svg-object" data="/assets/icons/forum.svg"
            type="image/svg+xml"></object>Feedback</a>
        <a class="link"><object class="svg-object" data="./assets/icons/support_agent.svg"
            type="image/svg+xml"></object>Support</a>
      </div>
    </div>
  </header>
  <div class="main-content">
    <header>
      <div class="logo">
        <img src="../assets/final_logo.svg" alt="logo" height="82px" />

      </div>
    </header>

    <form id="verifyForm" style="margin-top: 200px;" class="animate__animated animate__pulse animate__faster">

      <div class="lower-content">
        <section>
          <div class="form-group">
            <label>Certificate ID or Number
              <span style="color: red; font-weight: bold">*</span></label>
            <input id="appIdInput" type="text" name="" placeholder="eg: RIDXR32354" required />

          </div>
        </section>
        <div id="span-message">
          <span id="innerspan">hello</span><span id="message">world</span>
        </div>

        <div class="buttons">

          <!-- Apply Certificate Button -->
          <a href="/Certificate-Verification/Applay-certificate.html" class="btn">
            <span class="material-symbols-outlined">new_releases</span>
            Apply For Certificate
          </a>

       <button type="button" class="btn" onclick="verify()">
  <span class="material-symbols-outlined">new_releases</span>
  Verify Certificate
</button>



          <!-- Download Certificate Button -->
          <a id="detailCertificatePath" target="_blank" class="btn">
            <span class="material-symbols-outlined">download</span>
            Download Certificate
          </a>

        </div>

        <div style="display: flex; gap: 20px; align-items: center">
          <div id="result" style="display: none"></div>
          <button type="button" id="infoButton" class="info-button"
            style="display: none; position: relative; top: 20px">
            i
          </button>
        </div>
        <div class="certificate-details" id="certificateDetails" style="display: none">
          <h2>Certificate Details</h2>
          <p>
            <strong>Certificate ID:</strong>
            <span id="detailCertificateId"></span>
          </p>
          <p>
            <strong>Intern Name:</strong> <span id="detailInternName"></span>
          </p>
          <p>
            <strong>Issue Date:</strong> <span id="detailIssueDate"></span>
          </p>
          <p>
            <strong>Description:</strong> <span id="detailDescription"></span>
          </p>
          <!-- <p><strong>Certificate:</strong> <a id="detailCertificatePath" href="#" target="_blank">View Certificate</a></p> -->
        </div>

        <span class="spanfooter"><span>Note:</span>Incase of failure of certificate validation,
          please contact us for further process.</span>
      </div>
    </form>
    <div class="upper-content">

      <h2>RID's Certificate Verification & Validation</h2>
      <p>
        Welcome to RID’s Certificate Verification & Validation, Here you can
        easily, verify the status of Research Innovation & Discovery
        certificate for an internship, training program, seminar, webinar or
        workshop programs, you may search as follows:
      </p>
      <li>
        <span>Step 1: Visit the official website of the Research
          Innovation & Discovery (RID). </span>
      </li>
      <li>
        <span>Step 2: Look for a "Certificate" or "Verify Certificate"
          button on top of the landing page.</span>
      </li>
      <li>
        <span>Step 3: Enter the unique certificate number or
          certificate id.</span>
      </li>
      <li>
        <span>Step 4: Review the results to confirm the validity and
          status of the certificate.</span>
      </li>
    </div>



  </div>
  <div id="popup" class="popup-overlay">
    <div class="popup-content">
      <button id="closePopup" class="popup-close">&times;</button>
      <h2 style="color: #007bff">Certificate Information</h2>
      <p>
        <strong>Certificate ID:</strong> <span id="popupCertificateId"></span>
      </p>
      <p><strong>Intern Name:</strong> <span id="popupInternName"></span></p>
      <p><strong>Issue Date:</strong> <span id="popupIssueDate"></span></p>
      <p><strong>Description:</strong> <span id="popupDescription"></span></p>
    </div>
  </div>

<script>
// verify.html के JavaScript में यह फंक्शन अपडेट करें
async function verify() {
  const appId = document.getElementById("appIdInput").value.trim();
  
  if (!appId) {
    alert("Please enter Application ID");
    return;
  }

  // Check if it's a workshop/training certificate (new system)
  if (appId.startsWith('RID-WS') || appId.startsWith('RID-TR')) {
    await verifyWorkshopCertificate(appId);
  } else {
    // Original verification for old certificates
    await verifyOldCertificate(appId);
  }
}

// Function to verify workshop/training certificates
async function verifyWorkshopCertificate(appId) {
  try {
    console.log("Verifying workshop certificate:", appId);
    const response = await fetch(`/api/workshop/verify/${appId}`);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();

    if (data.success) {
      const app = data.application;
      
      if (app.status === "VERIFIED") {
        // Show download button
        const downloadBtn = document.getElementById("detailCertificatePath");
        downloadBtn.href = `/api/workshop/download/${appId}`;
        downloadBtn.style.display = "inline-flex";
        downloadBtn.innerHTML = '<span class="material-symbols-outlined">download</span>Download Certificate';
        
        // Show success message
        document.getElementById("result").innerHTML = `
          <div style="color: #16a34a; padding: 15px; background: #f0fdf4; border-radius: 8px; margin-top: 20px;">
            <strong style="font-size: 18px;">✅ Certificate Verified Successfully!</strong>
            <p style="margin: 10px 0 0 0;">Your certificate is ready to download.</p>
          </div>
        `;
        document.getElementById("result").style.display = "block";
        
        // Show certificate details
        document.getElementById("certificateDetails").style.display = "block";
        document.getElementById("detailCertificateId").textContent = app.appId;
        document.getElementById("detailInternName").textContent = app.fullName;
        document.getElementById("detailIssueDate").textContent = new Date(app.createdAt).toLocaleDateString();
        document.getElementById("detailDescription").textContent = `${app.certificateType.toUpperCase()} Certificate - Duration: ${app.duration} ${app.durationUnit}`;
        
      } else if (app.status === "PENDING") {
        document.getElementById("result").innerHTML = `
          <div style="color: #d97706; padding: 15px; background: #fffbeb; border-radius: 8px; margin-top: 20px;">
            <strong style="font-size: 18px;">⏳ Certificate Pending Verification</strong>
            <p style="margin: 10px 0 0 0;">Your certificate is under review. You'll receive an email when verified.</p>
          </div>
        `;
        document.getElementById("result").style.display = "block";
        
        document.getElementById("certificateDetails").style.display = "block";
        document.getElementById("detailCertificateId").textContent = app.appId;
        document.getElementById("detailInternName").textContent = app.fullName;
        document.getElementById("detailIssueDate").textContent = new Date(app.createdAt).toLocaleDateString();
        document.getElementById("detailDescription").textContent = "Certificate is pending verification";
        
      } else {
        document.getElementById("result").innerHTML = `
          <div style="color: #dc2626; padding: 15px; background: #fef2f2; border-radius: 8px; margin-top: 20px;">
            <strong style="font-size: 18px;">❌ Certificate Rejected</strong>
            <p style="margin: 10px 0 0 0;">This certificate application has been rejected. Please contact support.</p>
          </div>
        `;
        document.getElementById("result").style.display = "block";
      }
    } else {
      document.getElementById("result").innerHTML = `
        <div style="color: #dc2626; padding: 15px; background: #fef2f2; border-radius: 8px; margin-top: 20px;">
          <strong style="font-size: 18px;">❌ Invalid Application ID</strong>
          <p style="margin: 10px 0 0 0;">Please check your Application ID and try again.</p>
        </div>
      `;
      document.getElementById("result").style.display = "block";
    }
  } catch (error) {
    console.error("Verification error:", error);
    document.getElementById("result").innerHTML = `
      <div style="color: #dc2626; padding: 15px; background: #fef2f2; border-radius: 8px; margin-top: 20px;">
        <strong style="font-size: 18px;">⚠️ Error Verifying Certificate</strong>
        <p style="margin: 10px 0 0 0;">Please try again or contact support if the problem persists.</p>
      </div>
    `;
    document.getElementById("result").style.display = "block";
  }
}

// Function to verify old certificates (existing system)
async function verifyOldCertificate(appId) {
  try {
    const response = await fetch(`/api/verify/${appId}`);
    const data = await response.json();

    if (data.success) {
      if (data.status === "VERIFIED") {
        // Show download button
        const downloadBtn = document.getElementById("detailCertificatePath");
        downloadBtn.href = `/api/download/${appId}`;
        downloadBtn.style.display = "inline-flex";
        
        // Update download text based on certificate type
        if (data.certificateType === 'EXPERIENCE_LETTER') {
          downloadBtn.innerHTML = '<span class="material-symbols-outlined">download</span>Download Experience Letter';
        } else {
          downloadBtn.innerHTML = '<span class="material-symbols-outlined">download</span>Download Certificate';
        }
        
        // Show success message
        document.getElementById("result").innerHTML = `
          <div style="color: #16a34a; font-weight: bold;">
            ✅ Certificate Verified! Ready to download.
          </div>
          <p>Certificate Type: <strong>${data.certificateType === 'CERTIFICATE_OF_COMPLETION' ? 'Certificate of Completion' : 'Experience Letter'}</strong></p>
        `;
        document.getElementById("result").style.display = "block";
        
        // Show certificate details
        document.getElementById("certificateDetails").style.display = "block";
        document.getElementById("detailCertificateId").textContent = data.applicationId;
        document.getElementById("detailInternName").textContent = data.name;
        document.getElementById("detailIssueDate").textContent = new Date().toLocaleDateString();
        document.getElementById("detailDescription").textContent = `${data.certificateType === 'CERTIFICATE_OF_COMPLETION' ? 'Certificate' : 'Experience Letter'} for ${data.course} - ${data.projectName} (${data.duration} weeks)`;
        
      } else {
        document.getElementById("result").innerHTML = `
          <div style="color: #d97706; font-weight: bold;">
            ⏳ Certificate Pending Verification
          </div>
          <p>Your certificate is under review. You'll receive an email when verified.</p>
        `;
        document.getElementById("result").style.display = "block";
      }
    } else {
      document.getElementById("result").innerHTML = `
        <div style="color: #dc2626; font-weight: bold;">
          ❌ Invalid Application ID
        </div>
        <p>Please check your Application ID and try again.</p>
      `;
      document.getElementById("result").style.display = "block";
    }
  } catch (error) {
    console.error(error);
    alert("Error verifying certificate. Please try again.");
  }
}

// Enter key support
document.getElementById("appIdInput").addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    verify();
  }
});
</script>
</body>

</html>